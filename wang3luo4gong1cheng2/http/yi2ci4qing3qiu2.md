## 一次http请求的过程

- 2021-10-29
- DNS
- TCP/IP
- HTTP

### 一次http请求的过程

- 浏览器解析路由
- 浏览器解析域名
- 通过域名解析得到ip地址
- 浏览器与服务器建立tcp连接
- 浏览器给服务器发送http请求
- 服务器响应浏览器的http请求
- 浏览器解析响应数据中的资源
- 浏览器关闭tcp连接
- 浏览器渲染页面

### 域名结构树

比如：`www.bilibili.com`和`space.bilibili.com`。

`www.bilibili.com`表示访问bilibili的主站。`space.bilibili.com`表示访问bilibili的个人空间。

`.bilibili`表示`www.bilibili.com`和`space.bilibili.com`都隶属于`.bilibili`域名统一管理。

`.com`表示供商业机构使用的顶级域名，`.bilibili`域名就隶属于`.com`统一管理。

`.com`域名又是被根域名管理的，现在通常省略根域名。其实完整的域名应该是`www.bilibili.com.`，后面还有个`.`表示根域名，也就是`.root`。最终所有的域名都是被根域名管理的。

### 域名服务器

根域名是由一群服务器组成的，这群服务器用了13个不同的域名，从a~m开头，后面都是`.root-servers.net`，如`a.root-servers.net`。

13个根域名由上千台根服务器（也可叫节点）组成，由12个独立机构运营。也就是说绝大部分的根域名的节点的ip地址是一样的。通过任波技术，当我们向根服务器进行联系时就能找到离我们最近的根域名服务器。

根域名服务器会管理`.com`，`.cn`，`.net`这些顶级域名服务器（Top Level Domain,TLD）。
顶级域名服务器会管理各自的权限（Authoritative）域名服务器（权威域名服务器），如`.bilibili`，`.qq`。权限域名服务器会管理各自的主机。

### DNS

域名系统（Domain Name System）是将域名和ip地址相互映射的一个分布式数据库。

域名解析的作用是把域名解析到一个网站服务器的ip地址。DNS使用UDP端口53。

浏览器首先会搜索浏览器的DNS缓存。如果浏览器的DNS缓存中没有对应的域名，那么会搜索操作系统的DNS缓存。如果操作系统的DNS缓存中没有对应的域名，那么会尝试读取host文件。

如果任然没有对应的域名，那么浏览器会通过电脑上的客户端DNS解析器向本地DNS服务器发起一次域名解析请求。本地DNS服务器一般由互联网服务提供商（ISP）负责管理，比如中国电信。没有缓存的情况下，本地DNS服务器解析域名的步骤如下：

- 1、咨询根域名服务器，返回com服务器地址。
- 2、咨询com域名服务器，返回bilibili.com服务器地址。
- 3、咨询bilibili.com域名服务器，返回www.bilibili.com的ip地址。
- 4、将ip返回给浏览器。

解析器DNS客户端与本地DNS服务器之间是递归方式传输，发送数据后等着返回结果就行了。本地DNS服务器和其他三个域名服务器之间用迭代方式传输，就是一步一步操作，最终得到ip。

DNS劫持和DNS污染

### IP

ip（Internet Protocol）是指网际互连协议，是tcp/ip体系中的网络层协议。

ip地址（Internet Protocol Address）是指互联网协议地址。是ip协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址，以此来屏蔽物理地址的差异。

ipv4地址由4组8位二进制数组成，理论上可以提供2^32个ip地址。

ipv6地址由8组4位十六进制数组成

---

NAT网络地址转换

端口映射

ipv4借助公网ip和私有ip苟延残喘